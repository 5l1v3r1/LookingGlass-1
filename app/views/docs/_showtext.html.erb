<% first_doc = @link_type["Link Type"] == "mult_items" ? @docs.first : @doc %>

<!-- For when there are never item fields -->
<% if @link_type["Link Type"] != "mult_items" %>
  <% @field_info_sorted.each do |f| %>
    <% if checkIfX(f, @doc_page_fields) && !checkIfX(f, @facet_fields) %>
      <p><%= raw prepareField(f, @doc) %></p>
    <% end %>
  <% end %>
    
<!-- For when some are item fields -->
<% else %>
  <!-- Non-item fields -->
  <% @field_info_sorted.each do |f| %>
    <% if checkIfX(f, @doc_page_fields) && !checkIfX(f, @facet_fields) && !checkIfX(f, @item_fields) %>
      <p><%= raw prepareField(f, first_doc) %></p>
    <% end %>
  <% end %>

  <!-- Item fields -->
  <hr /><hr />
  <% item_field_sort(@docs, @show_sort_field).each do |d| %>
    <% @field_info_sorted.each do |f| %>
      <% if checkIfX(f, @item_fields) %>
        <%= raw prepareField(f, d) %><br />
      <% end %>
   <% end %>
   <hr />
   <% end %>
   
<% end %>
