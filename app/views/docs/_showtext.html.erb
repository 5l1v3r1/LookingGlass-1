<% first_doc = getFirstDoc %>

<!-- For when there are never item fields -->
<% if @link_type["Link Type"] != "mult_items" %>
  <% non_facet_check = Proc.new{ |f| checkIfX(f, @doc_page_fields) && !checkIfX(f, @facet_fields)} %>
  <%= raw(printFields(@doc, non_facet_check)) %>
    
<!-- For when some are item fields -->
<% else %>
  <!-- Non-item fields -->
  <% non_item_check = Proc.new{ |f| checkIfX(f, @doc_page_fields) && !checkIfX(f, @facet_fields) && !checkIfX(f, @item_fields)} %>
  <%= raw(printFields(first_doc, non_item_check)) %>

  <!-- Item fields -->
  <hr /><hr />
  <!-- Sorts docs by specified field and loops through in order -->
  <% item_field_sort(@docs, @show_sort_field).each do |d| %>
    <% item_check = Proc.new{ |f| checkIfX(f, @item_fields) } %>
    <%= raw(printFields(d, item_check)) %>
   <hr />
   <% end %>
   
<% end %>
